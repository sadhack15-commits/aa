# CÃ€I Äáº¶T ULTRAVIEWER - KHÃ”NG Cáº¦N GITHUB
      - name: ðŸ“º CÃ€I Äáº¶T ULTRAVIEWER
        run: |
          Write-Host ""
          Write-Host "ðŸ“º ÄANG CÃ€I Äáº¶T ULTRAVIEWER" -ForegroundColor Yellow
          
          try {
              # Cáº¥u hÃ¬nh máº¡ng vÃ  TLS
              [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
              [Net.ServicePointManager]::ServerCertificateValidationCallback = { $true }
              
              # Fix DNS báº±ng cÃ¡ch thÃªm Google DNS
              Write-Host "â”‚ ðŸ”§ Cáº¥u hÃ¬nh DNS..." -ForegroundColor Blue
              try {
                  # Láº¥y interface Ä‘ang active
                  $adapter = Get-NetAdapter | Where-Object {$_.Status -eq "Up"} | Select-Object -First 1
                  if ($adapter) {
                      # ThÃªm Google DNS lÃ m backup
                      Set-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -ServerAddresses ("8.8.8.8","8.8.4.4") -ErrorAction SilentlyContinue
                      Write-Host "â”‚ âœ… ÄÃ£ cáº¥u hÃ¬nh DNS" -ForegroundColor Green
                      Start-Sleep -Seconds 3
                  }
              } catch {
                  Write-Host "â”‚ âš ï¸  Bá» qua cáº¥u hÃ¬nh DNS" -ForegroundColor Yellow
              }
              
              # Danh sÃ¡ch nguá»“n táº£i - KHÃ”NG Cáº¦N GITHUB
              $downloadSources = @(
                  @{
                      Url="https://www.ultraviewer.net/en/UltraViewer_setup_6.6_en.exe"
                      Name="UltraViewer Official"
                      Method="WebClient"
                  },
                  @{
                      Url="https://cdn.ultraviewer.net/UltraViewer_setup_6.6_en.exe"
                      Name="UltraViewer CDN"
                      Method="WebClient"
                  },
                  @{
                      Url="https://ultraviewer.net/UltraViewer_setup_6.6_en.exe"
                      Name="Mirror 1"
                      Method="WebRequest"
                  },
                  @{
                      Url="https://download.ultraviewer.net/UltraViewer_setup_6.6_en.exe"
                      Name="Download Server"
                      Method="WebClient"
                  }
              )
              
              $uvPath = "$env:TEMP\UltraViewer_setup.exe"
              $downloaded = $false
              
              # Thá»­ tá»«ng nguá»“n vá»›i 2 phÆ°Æ¡ng thá»©c khÃ¡c nhau
              foreach ($source in $downloadSources) {
                  try {
                      Write-Host "â”‚ ðŸ“¥ Äang thá»­: $($source.Name)..." -ForegroundColor Blue
                      
                      if ($source.Method -eq "WebClient") {
                          # PhÆ°Æ¡ng thá»©c 1: WebClient (thÆ°á»ng á»•n Ä‘á»‹nh hÆ¡n)
                          $webClient = New-Object System.Net.WebClient
                          $webClient.Headers.Add("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
                          $webClient.Headers.Add("Accept", "*/*")
                          $webClient.Proxy = [System.Net.WebRequest]::DefaultWebProxy
                          $webClient.Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials
                          
                          # Táº£i vá»›i timeout
                          $downloadTask = $webClient.DownloadFileTaskAsync($source.Url, $uvPath)
                          $timeout = New-TimeSpan -Seconds 60
                          $stopwatch = [System.Diagnostics.Stopwatch]::StartNew()
                          
                          while (-not $downloadTask.IsCompleted) {
                              if ($stopwatch.Elapsed -gt $timeout) {
                                  $webClient.CancelAsync()
                                  throw "Timeout"
                              }
                              Start-Sleep -Milliseconds 500
                          }
                          
                          if ($downloadTask.IsFaulted) {
                              throw $downloadTask.Exception
                          }
                          
                      } else {
                          # PhÆ°Æ¡ng thá»©c 2: Invoke-WebRequest
                          $ProgressPreference = 'SilentlyContinue'
                          Invoke-WebRequest -Uri $source.Url -OutFile $uvPath `
                              -UseBasicParsing -TimeoutSec 60 `
                              -Headers @{
                                  "User-Agent" = "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
                              }
                      }
                      
                      # Kiá»ƒm tra file
                      if ((Test-Path $uvPath) -and ((Get-Item $uvPath).Length -gt 5MB)) {
                          $fileSize = [math]::Round((Get-Item $uvPath).Length / 1MB, 2)
                          Write-Host "â”‚ âœ… Táº£i thÃ nh cÃ´ng! ($fileSize MB)" -ForegroundColor Green
                          $downloaded = $true
                          break
                      } else {
                          Write-Host "â”‚ âš ï¸  File khÃ´ng há»£p lá»‡" -ForegroundColor Yellow
                          Remove-Item $uvPath -Force -ErrorAction SilentlyContinue
                      }
                      
                  } catch {
                      Write-Host "â”‚ âš ï¸  Lá»—i: $($_.Exception.Message -replace "`n"," ")" -ForegroundColor Yellow
                      Remove-Item $uvPath -Force -ErrorAction SilentlyContinue
                      Start-Sleep -Seconds 2
                  }
              }
              
              # Náº¿u váº«n khÃ´ng táº£i Ä‘Æ°á»£c, thá»­ phÆ°Æ¡ng Ã¡n cuá»‘i cÃ¹ng
              if (-not $downloaded) {
                  Write-Host "â”‚ ðŸ”„ Thá»­ phÆ°Æ¡ng Ã¡n cuá»‘i cÃ¹ng vá»›i curl..." -ForegroundColor Yellow
                  try {
                      $curlPath = "C:\Windows\System32\curl.exe"
                      if (Test-Path $curlPath) {
                          & $curlPath -L -A "Mozilla/5.0" --max-time 60 `
                              -o $uvPath "https://www.ultraviewer.net/en/UltraViewer_setup_6.6_en.exe"
                          
                          if ((Test-Path $uvPath) -and ((Get-Item $uvPath).Length -gt 5MB)) {
                              Write-Host "â”‚ âœ… Táº£i thÃ nh cÃ´ng vá»›i curl!" -ForegroundColor Green
                              $downloaded = $true
                          }
                      }
                  } catch {}
              }
              
              if (-not $downloaded) {
                  throw "KHÃ”NG THá»‚ Táº¢I ULTRAVIEWER - Vui lÃ²ng sá»­ dá»¥ng RDP"
              }
              
              # CÃ i Ä‘áº·t
              Write-Host "â”‚ ðŸ”§ Äang cÃ i Ä‘áº·t UltraViewer..." -ForegroundColor Blue
              $installArgs = @(
                  "/VERYSILENT",
                  "/SUPPRESSMSGBOXES", 
                  "/NORESTART",
                  "/SP-",
                  "/NOICONS"
              )
              
              $process = Start-Process -FilePath $uvPath `
                  -ArgumentList $installArgs `
                  -Wait -PassThru -NoNewWindow
              
              Write-Host "â”‚ â³ Chá» cÃ i Ä‘áº·t hoÃ n táº¥t..." -ForegroundColor Blue
              Start-Sleep -Seconds 20
              
              # TÃ¬m UltraViewer
              $uvExe = $null
              $searchPaths = @(
                  "C:\Program Files (x86)\UltraViewer\UltraViewer_Desktop.exe",
                  "C:\Program Files\UltraViewer\UltraViewer_Desktop.exe"
              )
              
              # TÃ¬m trong cáº£ á»• C:\ náº¿u khÃ´ng tÃ¬m tháº¥y
              foreach ($path in $searchPaths) {
                  if (Test-Path $path) {
                      $uvExe = $path
                      break
                  }
              }
              
              if (-not $uvExe) {
                  Write-Host "â”‚ ðŸ” TÃ¬m kiáº¿m UltraViewer trong há»‡ thá»‘ng..." -ForegroundColor Blue
                  $found = Get-ChildItem -Path "C:\Program Files*" -Filter "UltraViewer_Desktop.exe" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1
                  if ($found) {
                      $uvExe = $found.FullName
                  }
              }
              
              if ($uvExe) {
                  Write-Host "â”‚ âœ… TÃ¬m tháº¥y UltraViewer: $uvExe" -ForegroundColor Green
                  
                  # Khá»Ÿi Ä‘á»™ng
                  Write-Host "â”‚ ðŸš€ Äang khá»Ÿi Ä‘á»™ng..." -ForegroundColor Blue
                  Start-Process -FilePath $uvExe -ErrorAction SilentlyContinue
                  Start-Sleep -Seconds 15
                  
                  # Láº¥y thÃ´ng tin
                  Write-Host "â”‚ ðŸ” Äang láº¥y ID & Password..." -ForegroundColor Blue
                  
                  $uvId = $null
                  $uvPass = $null
                  
                  # Thá»­ láº¥y tá»« registry
                  $regPaths = @(
                      "HKLM:\SOFTWARE\UltraViewer",
                      "HKLM:\SOFTWARE\WOW6432Node\UltraViewer",
                      "HKCU:\SOFTWARE\UltraViewer"
                  )
                  
                  for ($i = 0; $i -lt 20; $i++) {
                      foreach ($regPath in $regPaths) {
                          try {
                              if (Test-Path $regPath) {
                                  $uvId = (Get-ItemProperty -Path $regPath -ErrorAction SilentlyContinue).ID
                                  $uvPass = (Get-ItemProperty -Path $regPath -ErrorAction SilentlyContinue).Password
                                  
                                  if ($uvId) { 
                                      Write-Host "â”‚ âœ… ID: $uvId" -ForegroundColor Green
                                      break 
                                  }
                              }
                          } catch {}
                      }
                      
                      if ($uvId) { break }
                      
                      Write-Host "â”‚ ðŸ”„ Äá»£i UltraViewer khá»Ÿi táº¡o... ($($i+1)/20)" -ForegroundColor Yellow
                      Start-Sleep -Seconds 3
                  }
                  
                  if ($uvId) {
                      echo "UV_ID=$uvId" >> $env:GITHUB_ENV
                  } else {
                      Write-Host "â”‚ âš ï¸  KhÃ´ng láº¥y Ä‘Æ°á»£c ID tá»± Ä‘á»™ng - Xem trong app" -ForegroundColor Yellow
                      echo "UV_ID=Má»Ÿ app Ä‘á»ƒ xem" >> $env:GITHUB_ENV
                  }
                  
                  if ($uvPass) {
                      Write-Host "â”‚ âœ… Password: $uvPass" -ForegroundColor Green
                      echo "UV_PASS=$uvPass" >> $env:GITHUB_ENV
                  } else {
                      echo "UV_PASS=Xem trong app" >> $env:GITHUB_ENV
                  }
                  
              } else {
                  throw "KhÃ´ng tÃ¬m tháº¥y UltraViewer sau khi cÃ i"
              }
              
              # Cleanup
              Remove-Item $uvPath -Force -ErrorAction SilentlyContinue
              
          } catch {
              Write-Host ""
              Write-Host "â”‚ âŒ Lá»–I: $($_.Exception.Message)" -ForegroundColor Red
              Write-Host "â”‚" -ForegroundColor Gray
              Write-Host "â”‚ ðŸ’¡ KHÃ”NG SAO! Báº¡n váº«n cÃ³ RDP Ä‘á»ƒ sá»­ dá»¥ng" -ForegroundColor Cyan
              Write-Host "â”‚ ðŸ“Œ Sau khi káº¿t ná»‘i RDP, báº¡n cÃ³ thá»ƒ:" -ForegroundColor Blue
              Write-Host "â”‚    1. Má»Ÿ trÃ¬nh duyá»‡t" -ForegroundColor White
              Write-Host "â”‚    2. Táº£i UltraViewer tá»«: ultraviewer.net" -ForegroundColor White
              Write-Host "â”‚    3. CÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng" -ForegroundColor White
              Write-Host ""
              
              echo "UV_ID=CÃ i báº±ng tay qua RDP" >> $env:GITHUB_ENV
              echo "UV_PASS=ultraviewer.net" >> $env:GITHUB_ENV
          }
